<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario Escaleras</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px;
      text-align: left;
    }
    th {
      background-color: #0B3B8C;
      color: white;
    }
  </style>
</head>
<body>
  <h2>Formulario de Registro de Escaleras</h2>

  <form id="formulario" action="https://n8n.tecnico.i.telconet.net/webhook-test/formulario_escaleras" method="POST">
    <label>Fecha y hora:</label><br>
    <input type="text" name="fecha" id="fecha" required readonly><br><br>

    <label>N° Vehículo:</label><br>
    <input type="text" name="vehiculo" required><br><br>

    <label>Placas:</label><br>
    <input type="text" name="placas" required><br><br>

    <label>Responsable (Correo):</label><br>
    <input type="email" name="responsable" required><br><br>

    <!-- Campos para agregar equipos -->
    <label>Serie del Equipo:</label><br>
    <input type="text" id="serie_temp"><br><br>

    <label>Nombre del Artículo:</label><br>
    <input type="text" id="articulo_temp"><br><br>

    <label>Estado:</label><br>
    <select id="estado_temp">
      <option value="Buen estado">Buen estado</option>
      <option value="Dañado">Dañado</option>
      <option value="Faltante">Faltante</option>
    </select><br><br>

    <button type="button" onclick="agregarEquipo()">+ Agregar Equipo</button><br><br>

    <!-- Tabla con equipos agregados -->
    <table id="tabla_equipos">
      <thead>
        <tr>
          <th>Serie</th>
          <th>Nombre del Artículo</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <br>
    <label>Observación:</label><br>
    <textarea name="observacion" rows="4" cols="50"></textarea><br><br>

    <!-- Campo oculto para equipos en formato texto -->
    <input type="hidden" name="equipos" id="equipos_json">

    <button type="submit">Enviar</button>
  </form>

  <script>
    const hoy = new Date();
    const fechaFormateada = hoy.toLocaleString('es-EC');
    document.getElementById('fecha').value = fechaFormateada;

    const equipos = [];

    function agregarEquipo() {
      const serie = document.getElementById('serie_temp').value.trim();
      const articulo = document.getElementById('articulo_temp').value.trim();
      const estado = document.getElementById('estado_temp').value;

      if (!serie || !articulo) {
        alert('Falta completar serie o artículo');
        return;
      }

      equipos.push({ serie, articulo, estado });
      actualizarTabla();
      document.getElementById('serie_temp').value = '';
      document.getElementById('articulo_temp').value = '';
    }

    function actualizarTabla() {
      const tbody = document.querySelector('#tabla_equipos tbody');
      tbody.innerHTML = '';

      equipos.forEach(item => {
        const fila = document.createElement('tr');
        fila.innerHTML = `<td>${item.serie}</td><td>${item.articulo}</td><td>${item.estado}</td>`;
        tbody.appendChild(fila);
      });

      document.getElementById('equipos_json').value = JSON.stringify(equipos);
    }
  </script>
</body>
</html>
